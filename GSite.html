<script>
  // TODO: populate subcategories and the other fields
  // TODO: update subcategory field after selecting one category
  
  function populateSelect(selectElement, options, defaultOption) {
    options.forEach((value) => {
      let optionElement = document.createElement("option");
      optionElement.value= value;
      optionElement.innerHTML = value;
      selectElement.appendChild(optionElement);
    });
    selectElement.value = defaultOption;
  }

  function selectCategory(selectElement) {
    console.log(event);
    console.log(selectElement.value)
  }

  function formatDate(date) {
    const year = date.getFullYear().toString();
    const month = (date.getMonth() + 1).toString().padStart(2, "0");
    const day = date.getDate().toString().padStart(2, "0");
    return `${year}-${month}-${day}`;
  }
  
  function goToGoogleForm() {
    let elements = null;

    elements = document.getElementsByName("date");
    const date = elements[0].value;
    console.log(date);
    
    elements = document.getElementsByName("category");
    const category = elements[0].value
    console.log(category);
    
    elements = document.getElementsByName("subcategory");
    const subcategory = elements[0].value;
    console.log(subcategory);

    elements = document.getElementsByName("account");
    const account = elements[0].value;
    console.log(account);

    elements = document.getElementsByName("description");
    const description = elements[0].value;
    console.log(description);

    elements = document.getElementsByName("value");
    const value = elements[0].value;
    console.log(value);

    const url = `https://docs.google.com/forms/d/e/1FAIpQLSevL7ZcgmFDkLUBr_pj-T0bypAjDgq3PRjAvn8Frt9qXk88GQ/viewform?usp=pp_url&entry.33770901=${date}&entry.1700463900=${category}&entry.1045532207=${subcategory}&entry.59325913=${account}&entry.1948022534=${discount}&entry.31627014=${description}&entry.1746868782=${value}`;
    // console.log(url)

    window.location.href = url;
  }

  const categoryTree = {
     "Celular": {},
     "Comida": {},
     "Psicólogo": {},
     "Salud": {},
     "Transporte": {}
  }; 

  const defaultAccountList = ["Itaú", "BROU"];

  window.onload = () => {
    const dateInput = document.getElementsByName("date")[0];
    const today = new Date();
    dateInput.value = formatDate(today);

    const categorySelect = document.getElementsByName("category")[0];
    const categoryList = Object.keys(categoryTree).sort();
    const defaultCategory =  categoryList[0];
    populateSelect(categorySelect, categoryList, defaultCategory);

    const subcategorySelect = document.getElementsByName("subcategory")[0];
    const subcategoryList = Object.keys(categoryTree[defaultCategory]).sort();
    let accountList = defaultAccountList;
    if (subcategoryList.length === 0) {
      subcategorySelect.disabled = true;
    } else {
      const defaultSubcategory = subcategoryList[0];
      accountList = categoryTree[defaultCategory][defaultSubcategory];
      populateSelect(subcategorySelect, subcategoryList, defaultSubcategory);
    }

    const accountSelect = document.getElementsByName("account")[0];
    const defaultAccount = accountList[0];
    populateSelect(accountSelect, accountList, defaultAccount);

  }

</script>
<style>
  input, select {
    height: 3em; 
    margin-bottom: 2em;
    font-size: 1em;
    width:100%;
  }
</style>
<div style="display:flex;flex-direction:column;">
  <input type="date" name="date"/>
  <select name="category" onchange="selectCategory(this)"></select>
  <select name="subcategory" onchange="selectSubcategory(this)"></select>
  <select name="account" onchange="selectAccount(this)"></select>
  <input type="number" name="value" placeholder="Valor"/>
  <input name="description" placeholder="Descripción"/>
  <input type="button" onClick="goToGoogleForm()" value="Finalizar">
<div/>
